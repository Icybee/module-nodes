define("icybee/nodes/adjust-node",["brickrouge"],(e=>{"use strict";const t={adjust:"adjust-node",constructor:"nodes"},n=e.Subject.createEvent(function(e,t,n){this.target=e,this.selected=t,this.event=n}),s=e.Subject.createEvent(function(e,t,n){this.target=e,this.selected=t,this.event=n}),i=e.Subject.createEvent(function(e,t){this.target=e,this.response=t}),o=class extends e.mixin(Object,e.Subject){constructor(e,i){super();this.element=e;this.nid=null;this.fetchResultsOperation=null;this.options=Object.assign({},t,i);const o=this.attachSearch();const c=this.getSelected();if(c){this.nid=c.get("data-nid")}this.element.addDelegatedEventListener(".records [data-nid]","click",((e,t)=>{e.stopPropagation();e.preventDefault();const i=this.getSelected();if(i){i.getParent("li").removeClass("selected")}t.getParent("li").addClass("selected");this.nid=t.getAttribute("data-nid");this.notify(new n(this,t,e));this.notify(new s(this,t,e))}));this.element.addDelegatedEventListener(".pagination a","click",((e,t)=>{e.stopPropagation();e.preventDefault();const n=t.getAttribute("href").split("#")[1];this.fetchResults({page:n,search:o?o.value:null,selected:this.getValue()})}))}attachSearch(){const e=this.element.querySelector("input.search");let t=null;e.onsubmit=(()=>false);e.addEvent("keyup",(e=>{if(e.key=="esc"){e.target.value=""}const n=e.target.value;if(n!=t){this.fetchResults({search:n,selected:this.getValue()})}t=n}));return e}fetchResults(e){if(!this.fetchResultsOperation){this.fetchResultsOperation=new Request.Element({url:"widgets/"+this.options.adjust+"/results",onSuccess:(e,t)=>{e.replaces(this.element.querySelector(".results"));this.notify(new i(this,t))}})}e.constructor=this.options.constructor;this.fetchResultsOperation.get(e)}getValue(){return this.nid}setValue(e){if(e==this.getValue())return;this.nid=e;this.fetchResults({selected:e})}getSelected(){return this.element.querySelector(".records li.selected [data-nid]")}setSelected(e){this.setValue(e)}observeSelect(e){this.observe(n,e)}observeChange(e){this.observe(s,e)}observeResult(e){this.observe(i,e)}};return Object.defineProperties(o,{EVENT_SELECT:{value:n},EVENT_CHANGE:{value:s},EVENT_RESULT:{value:i}}),o})),!function(e){let t;e.register("AdjustNode",((e,n)=>{return t||(t=require("icybee/nodes/adjust-node")),new t(e,n)}))}(Brickrouge),define("icybee/nodes/pop-node",["brickrouge","icybee/spinner","icybee/adjust-popover"],function(e,t,n){const s={placeholder:"Select an entry",constructor:"nodes",adjust:"adjust-node"};return class extends t{constructor(e,t){super(e,Object.assign({},s,t));this.opening=false;this.popover=null;this.fetchAdjustOperation=new Request.Widget(this.options.adjust+"/popup",this.setupAdjust.bind(this))}open(){if(this.opening)return;this.opening=true;const e=this.getValue();this.resetValue=e;if(this.popover){this.popover.adjust.setValue(e);this.popover.show();this.opening=false;return}this.fetchAdjustOperation.get({selected:e,constructor:this.options.constructor})}setupAdjust(e){this.popover=new n(e,{anchor:this.element});this.popover.show();this.opening=false;this.popover.adjust.observeChange(this.change.bind(this));this.popover.observeAction(this.onAction.bind(this))}onAction(e){switch(e.action){case"cancel":this.cancel();break;case"remove":this.remove();case"use":this.use()}this.popover.hide()}change(e){this.setValue(e.selected.getAttribute("data-nid"))}cancel(){this.setValue(this.resetValue)}remove(){this.setValue("")}use(){this.element.fireEvent("change",{})}reset(){}}}),!function(e){let t;e.register("PopNode",((e,n)=>{return t||(t=require("icybee/nodes/pop-node")),new t(e,n)}))}(Brickrouge),define("icybee/nodes/title-slug-combo",[],function(){return class{constructor(e,t){this.element=e;this.options=t;const n=e.querySelector(".slug-reminder");const s=e.querySelector(".slug");const i=e.querySelector('a[href$="slug-edit"');const o=e.querySelector('a[href$="slug-collapse"]');const c=e.querySelector('a[href$="slug-delete"]');const r=s.querySelector("input");let u=false;function l(e){e.stop();u=!u;s.setStyle("display",u?"block":"none");n.setStyle("display",u?"none":"inline");o.setStyle("display",u?"inline":"none")}i.addEvent("click",l);o.addEvent("click",l);function a(){let t=r.get("value");const s=t?"text":"html";if(t){t=t.shorten();c.getParent("span").setStyle("display","inline")}else{t=e.get("data-auto-label");c.getParent("span").setStyle("display","none")}n.querySelector("a").set(s,t)}r.addEvent("change",a);c.addEvent("click",(e=>{e.stop();r.value="";r.fireEvent("change",{})}));a()}}}),!function(e){let t;e.register("TitleSlugCombo",function(e,n){return t||(t=require("icybee/nodes/title-slug-combo")),new t(e,n)})}(Brickrouge);
//# sourceMappingURL=public/module.js.map
