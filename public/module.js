define("icybee/nodes/adjust-node",["brickrouge"],(e=>{"use strict";const t=e.Subject,n={adjust:"adjust-node",constructor:"nodes"},s=t.createEvent(function(e,t,n){this.target=e,this.selected=t,this.event=n}),i=t.createEvent(function(e,t,n,s){this.value=t,this.target=e,this.nid=t,this.selected=n,this.event=s}),o=t.createEvent(function(e,t){this.target=e,this.response=t}),c=class extends e.mixin(Object,t){constructor(e,t){super();this.element=e;this.nid=null;this.fetchResultsRequest=null;this.options=Object.assign({},n,t);const s=this.selected;if(s){this.value=this.selectedToValue(s)}const i=this.attachSearch();this.listenToPagination(i);this.listenToResultClick()}listenToResultClick(){this.element.addDelegatedEventListener(".records [data-nid]","click",((e,t)=>{e.stopPropagation();e.preventDefault();const n=this.selected;if(n){n.closest("li").classList.remove("selected")}t.closest("li").classList.add("selected");const o=this.nid=t.getAttribute("data-nid");this.notify(new s(this,t,e));this.notify(new i(this,o,t,e))}))}listenToPagination(e){this.element.addDelegatedEventListener(".pagination a","click",((t,n)=>{t.stopPropagation();t.preventDefault();const s=n.getAttribute("href").split("#")[1];this.fetchResults({page:s,search:e?e.value:null,selected:this.value})}))}attachSearch(){const e=this.element.querySelector("input.search");let t=null;if(!e){return null}e.onsubmit=(()=>false);e.addEventListener("keyup",(e=>{if(e.key=="Escape"||e.keyCode==27){e.target.value=""}const n=e.target.value;if(n!=t){this.fetchResults({search:n,selected:this.value})}t=n}));return e}fetchResults(e){if(!this.fetchResultsRequest){this.fetchResultsRequest=new Request.Element({url:`widgets/${this.options.adjust}/results`,onSuccess:(e,t)=>{const n=this.element.querySelector(".results");n.parentNode.insertBefore(e,n);n.parentNode.removeChild(n);this.notify(new o(this,t))}})}e.constructor=this.options.constructor;this.fetchResultsRequest.get(e)}get value(){return this.nid}set value(e){if(e==this.value)return;this.nid=e;this.fetchResults({selected:e})}get selected(){return this.element.querySelector(".records li.selected [data-nid]")}set selected(e){this.value=this.selectedToValue(e)}selectedToValue(e){return parseInt(e.getAttribute("data-nid"))}observeSelect(e){this.observe(s,e)}observeChange(e){this.observe(i,e)}observeResult(e){this.observe(o,e)}};return Object.defineProperties(c,{EVENT_SELECT:{value:s},EVENT_CHANGE:{value:i},EVENT_RESULT:{value:o}}),c})),!function(e){let t;e.register("AdjustNode",((e,n)=>{return t||(t=require("icybee/nodes/adjust-node")),new t(e,n)}))}(Brickrouge),define("icybee/nodes/pop-node",["brickrouge","icybee/spinner","icybee/adjust-popover"],function(e,t,n){const s={placeholder:"Select an entry",constructor:"nodes",adjust:"adjust-node"};return class extends t{constructor(e,t){super(e,Object.assign({},s,t))}createPopover(e){new Request.Widget(this.options.adjust+"/popup",(t=>{e(new n(t,{anchor:this.element}))})).get({selected:this.value,constructor:this.options.constructor})}}}),!function(e){let t;e.register("PopNode",((e,n)=>{return t||(t=require("icybee/nodes/pop-node")),new t(e,n)}))}(Brickrouge),define("icybee/nodes/title-slug-combo",[],function(){return class{constructor(e,t){this.element=e;this.options=t;const n=e.querySelector(".slug-reminder");const s=e.querySelector(".slug");const i=e.querySelector('a[href$="slug-edit"');const o=e.querySelector('a[href$="slug-collapse"]');const c=e.querySelector('a[href$="slug-delete"]');const u=s.querySelector("input");let r=false;function l(e){e.stop();r=!r;s.setStyle("display",r?"block":"none");n.setStyle("display",r?"none":"inline");o.setStyle("display",r?"inline":"none")}i.addEvent("click",l);o.addEvent("click",l);function a(){let t=u.get("value");const s=t?"text":"html";if(t){t=t.shorten();c.getParent("span").setStyle("display","inline")}else{t=e.get("data-auto-label");c.getParent("span").setStyle("display","none")}n.querySelector("a").set(s,t)}u.addEvent("change",a);c.addEvent("click",(e=>{e.stop();u.value="";u.fireEvent("change",{})}));a()}}}),!function(e){let t;e.register("TitleSlugCombo",function(e,n){return t||(t=require("icybee/nodes/title-slug-combo")),new t(e,n)})}(Brickrouge);
//# sourceMappingURL=public/module.js.map
