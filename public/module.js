define("icybee/nodes/adjust-node",[],function(){return new Class({Implements:[Options,Events],options:{adjust:"adjust-node",constructor:"nodes"},initialize:function(a,b){this.element=document.id(a);this.fetchResultsOperation=this.nid=null;this.setOptions(b);var c=this.attachSearch(),d=this.getSelected();d&&(this.nid=d.get("data-nid"));this.element.addDelegatedEventListener(".records [data-nid]","click",function(a,c){a.stopPropagation();a.preventDefault();var d=this.getSelected();d&&d.getParent("li").removeClass("selected");
c.getParent("li").addClass("selected");this.nid=c.getAttribute("data-nid");this.fireEvent("select",{target:this,selected:c,event:a});this.fireEvent("change",{target:this,selected:c,event:a})}.bind(this));this.element.addDelegatedEventListener(".pagination a","click",function(a,d){a.stopPropagation();a.preventDefault();var b=d.getAttribute("href").split("#")[1];this.fetchResults({page:b,search:c?c.value:null,selected:this.getValue()})}.bind(this))},attachSearch:function(){var a=this.element.querySelector("input.search"),
b=null;a.onsubmit=function(){return!1};a.addEvent("keyup",function(a){"esc"==a.key&&(a.target.value="");a=a.target.value;a!=b&&this.fetchResults({search:a,selected:this.getValue()});b=a}.bind(this));return a},fetchResults:function(a){this.fetchResultsOperation||(this.fetchResultsOperation=new Request.Element({url:"widgets/"+this.options.adjust+"/results",onSuccess:function(a,c){a.replaces(this.element.querySelector(".results"));this.fireEvent("results",{target:this,response:c})}.bind(this)}));a.constructor=
this.options.constructor;this.fetchResultsOperation.get(a)},getValue:function(){return this.nid},setValue:function(a){a!=this.getValue()&&(this.nid=a,this.fetchResults({selected:a}))},getSelected:function(){return this.element.querySelector(".records li.selected [data-nid]")},setSelected:function(a){this.setValue(a)}})});!function(a){var b;a.register("AdjustNode",function(a,d){b||(b=require("icybee/nodes/adjust-node"));return new b(a,d)})}(Brickrouge);
define("icybee/nodes/pop-node",["brickrouge","icybee/spinner","icybee/adjust-popover"],function(a,b,c){return new Class({Extends:b,options:{placeholder:"Select an entry",constructor:"nodes",adjust:"adjust-node"},initialize:function(a,b){this.parent(a,b);this.opening=!1;this.popover=null;this.fetchAdjustOperation=new Request.Widget(this.options.adjust+"/popup",this.setupAdjust.bind(this))},open:function(){if(!this.opening){this.opening=!0;var a=this.getValue();this.resetValue=a;this.popover?(this.popover.adjust.setValue(a),
this.popover.show(),this.opening=!1):this.fetchAdjustOperation.get({selected:a,constructor:this.options.constructor})}},setupAdjust:function(a){this.popover=new c(a,{anchor:this.element});this.popover.show();this.opening=!1;this.popover.adjust.addEvent("change",this.change.bind(this));this.popover.observeAction(this.onAction.bind(this))},onAction:function(a){switch(a.action){case "cancel":this.cancel();break;case "remove":this.remove();case "use":this.use()}this.popover.hide()},change:function(a){this.setValue(a.selected.getAttribute("data-nid"))},
cancel:function(){this.setValue(this.resetValue)},remove:function(){this.setValue("")},use:function(){this.element.fireEvent("change",{})},reset:function(){}})});!function(a){var b;a.register("PopNode",function(a,d){b||(b=require("icybee/nodes/pop-node"));return new b(a,d)})}(Brickrouge);
define("icybee/nodes/title-slug-combo",[],function(){return new Class({initialize:function(a,b){function c(a){a.stop();e=!e;k.setStyle("display",e?"block":"none");h.setStyle("display",e?"none":"inline");l.setStyle("display",e?"inline":"none")}function d(){var b=f.get("value"),c=b?"text":"html";b?(b=b.shorten(),g.getParent("span").setStyle("display","inline")):(b=a.get("data-auto-label"),g.getParent("span").setStyle("display","none"));h.querySelector("a").set(c,b)}this.element=a;var h=a.querySelector(".slug-reminder"),
k=a.querySelector(".slug"),m=a.querySelector('a[href$="slug-edit"'),l=a.querySelector('a[href$="slug-collapse"]'),g=a.querySelector('a[href$="slug-delete"]'),f=k.querySelector("input"),e=!1;m.addEvent("click",c);l.addEvent("click",c);f.addEvent("change",d);g.addEvent("click",function(a){a.stop();f.value="";f.fireEvent("change",{})});d()}})});!function(a){var b;a.register("TitleSlugCombo",function(a,d){b||(b=require("icybee/nodes/title-slug-combo"));return new b(a,d)})}(Brickrouge);
